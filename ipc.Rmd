---
title: "Análisis exploratorio de datos"
output: html_document
---

La base de datos utilizada trata sobre el IPC de distintas ciudades colombianas, calculado mensualmente desde enero de 1979 hasta enero de 2025 por el DANE. El índice de precios al consumidor (IPC) es un indicador económico que mide la evolución (cambio) de los precios de los bienes y servicios que consumen las familias. Por lo tanto, es comúnmente empleado para medir la inflación en un periodo específico.

## Importar paquetes y cargar datos

```{r message=FALSE, warning=FALSE}
library(readxl)
library(dplyr)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(scales)
library(gridExtra)
library(tsibble)
library(writexl)

# Importar solo la hoja 2, y omitir las dos primeras filas (vacías).
df <- read_excel("inflacion.xlsx", sheet = 2, skip = 2)
```

## Ajustar el dataframe

```{r}
# Dar el formato correcto a las fechas.
colnames(df)[1] <- "Fecha"
df <- df[-c(1, nrow(df) ), ]
df$Fecha <- as.numeric(df$Fecha)
df$Fecha <- as.Date(df$Fecha, origin = "1899-12-30")

# Eliminar los espacios en los nombres de las columnas.
colnames(df) <- gsub("\u00A0", "_", colnames(df))

# Seleccionar las columnas de interés.
df <- df %>% select(Fecha, IPC_Barranquilla, IPC_Bogotá, IPC_Bucaramanga, IPC_Cali, IPC_Manizales, IPC_Medellín, IPC_Pasto)
```

## Exploración inicial

```{r}
head(df)
summary(df)
sum(is.na(df))
```

La tabla tiene 553 filas y 8 columnas (la primera para las fechas y las restantes para las siete ciudades). En cada fila se encuentra el IPC de las ciudades para cierta fecha. No hay datos faltantes.

## Preparación de los datos para el análisis

```{r}
# Convertir a formato largo para facilitar la visualización
ipc_long <- df %>%
  pivot_longer(
    cols = starts_with("IPC_"),
    names_to = "Ciudad",
    values_to = "IPC"
  ) %>%
  mutate(Ciudad = gsub("IPC_", "", Ciudad))

head(ipc_long, n=7)
```

Aquí se creó otro dataframe 'ipc_long' que tiene 3871 filas y 3 columnas. Se obtuvo de reescribir el dataframe original de tal manera que en cada fila esté el IPC de una ciudad específica para cierta fecha. De ahí que su número de filas sea el producto entre 553 (fechas) y 7 (ciudades).

## Análisis de tendencias temporales

```{r}
# Gráfico de series temporales para todas las ciudades
ggplot(ipc_long, aes(x = Fecha, y = IPC, color = Ciudad)) +
  geom_line() +
  scale_color_brewer(palette = "Set1") +
  labs(title = "Evolución del IPC en ciudades colombianas (1979-2025)",
       x = "Año",
       y = "IPC") +
  theme_minimal() +
  scale_x_date(date_breaks = "5 years", date_labels = "%Y") +
  theme(legend.position = "bottom")
```

El gráfico muestra que el IPC aumentó en las siete ciudades de una forma similar, con un crecimiento notable a inicios de los 90 y otra subida abrupta para 2021.

Ahora se hace un enfoque en la más reciente década.

```{r}
# Calcular la fecha de hace 10 años desde la última fecha en el dataset
ultima_fecha <- max(ipc_long$Fecha)
fecha_inicio <- ultima_fecha - years(10)

# Filtrar los datos para los últimos 10 años
ipc_10_anos <- ipc_long %>%
  filter(Fecha >= fecha_inicio)

# Crear el gráfico con los datos filtrados
ggplot(ipc_10_anos, aes(x = Fecha, y = IPC, color = Ciudad)) +
  geom_line(linewidth=1) +
  scale_color_brewer(palette = "Set1") +
  labs(title = "Evolución del IPC en ciudades colombianas (últimos 10 años)",
       x = "Año",
       y = "IPC") +
  theme_minimal() +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  theme(legend.position = "bottom")
```

De esta manera, se logra evidenciar que los distintos índices de las ciudades estaban más cercanos entre sí hace una década que ahora. Siendo (a enero de 2025) el de Barranquilla el más alto y el de Bogotá el más bajo.

Como se mencionó al inicio, el IPC es utilizado para medir la inflación en una región. Aquí su aplicación a estos datos.

```{r}
# Cálculo de tasas de inflación anual
ipc_inflation <- ipc_long %>%
  arrange(Ciudad, Fecha) %>%
  group_by(Ciudad) %>%
  mutate(
    Inflacion_Anual = (IPC / lag(IPC, 12) - 1) * 100
  ) %>%
  filter(!is.na(Inflacion_Anual))

# Guardar el dataframe limpio para usarlo en Python
write_xlsx(ipc_inflation, "inflacion_procesada.xlsx")

# Gráfico de inflación anual
ggplot(ipc_inflation, aes(x = Fecha, y = Inflacion_Anual, color = Ciudad)) +
  geom_line() +
  scale_color_brewer(palette = "Set1") +
  labs(title = "Inflación anual en ciudades colombianas (1980-2015)",
       x = "Año",
       y = "Tasa de inflación (%)") +
  theme_minimal() +
  scale_x_date(date_breaks = "5 years", date_labels = "%Y") +
  theme(legend.position = "bottom")
```

Se observan altas tasas de inflación (tasa de cambio porcentual del IPC) durante gran parte de los años 80 y 90, lo que coincide con un crecimiento exponencial en el IPC. Luego hay una disminución gradual hasta estabilizarse en valores más bajos después de 2000. El repunte de inflación alrededor de 2022 (que llega a aproximadamente 15%) coincide con el aumento más pronunciado en la curva del IPC en ese mismo periodo. Los gráficos muestran que las ciudades colombianas presentan patrones similares tanto en IPC como en inflación.

Nuevamente, haciendo un enfoque en los últimos años.

```{r}
# Filtrar los datos para los últimos 10 años
ipc_10_anos <- ipc_inflation %>%
  filter(Fecha >= fecha_inicio)

# Crear el gráfico con los datos filtrados
ggplot(ipc_10_anos, aes(x = Fecha, y = Inflacion_Anual, color = Ciudad)) +
  geom_line(linewidth=1) +
  scale_color_brewer(palette = "Set1") +
  labs(title = "Evolución de la inflación en ciudades colombianas (últimos 10 años)",
       x = "Año",
       y = "Inflación") +
  theme_minimal() +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  theme(legend.position = "bottom")
```

Se aprecia, como con el IPC, que la inflación parte de niveles similares en 2015 para las siete ciudades, pero actualmente sus valores se han distanciado. Siendo Bucaramanga la ciudad con mayor inflación en la actualidad y Barranquilla la ciudad con el menor de estos valores.

A continuación, se comparan las distribuciones de los datos en cada ciudad mediante otro tipo de diagrama.

```{r}
# Boxplots de inflación por ciudad
ggplot(ipc_inflation, aes(x = Ciudad, y = Inflacion_Anual, fill = Ciudad)) +
  geom_boxplot() +
  scale_color_brewer(palette = "Set1") +
  labs(title = "Distribución de la inflación anual por ciudad (1980-2015)",
       x = "Ciudad",
       y = "Tasa de inflación (%)") +
  theme_minimal() +
  theme(legend.position = "none") +
  coord_flip()
```

Con estos diagramas de caja se observa la ausencia de datos atípicos y se constata que las ciudades tienen distribuciones similares en lo que respecta a su inflación.




